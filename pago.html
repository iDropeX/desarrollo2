<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pago seguro ‚Äî Aircry JDM</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    :root{color-scheme:dark}
    body{background:#0a0a0a;color:#fff;font-family:system-ui,Segoe UI,Roboto,Arial;margin:0}
    .shell{width:min(1200px,92vw);margin:auto}
    .nav .bar{display:flex;justify-content:space-between;align-items:center;padding:16px 0}
    .btn{display:inline-flex;align-items:center;gap:8px;height:40px;padding:0 14px;border-radius:999px;border:1px solid #333;background:#121212;color:#fff;text-decoration:none;cursor:pointer}
    .btn.primary{background:#e21f1f;border:0}
    .btn.ghost{background:#0d0d0d;border:1px solid #333}
    .btn.disabled{opacity:.5;pointer-events:none}
    h1{color:#ff1f1f;margin:18px 0;text-align:center}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:20px}
    .panel{border:1px solid #2a2a2a;background:#0f0f0f;border-radius:14px;padding:16px}
    .list{display:grid;gap:10px}
    .row{display:grid;grid-template-columns:64px 1fr auto;gap:12px;align-items:center;border:1px solid #222;border-radius:12px;padding:10px;background:#0b0b0b}
    .row img{width:64px;height:64px;object-fit:cover;border-radius:10px}
    .price{font-weight:800}
    .summary .line{display:flex;justify-content:space-between;margin:8px 0}
    .summary .total{font-weight:900;font-size:18px}
    .field{display:grid;gap:6px;margin-bottom:10px}
    .input, select{height:44px;border-radius:10px;border:1px solid #333;background:#0a0a0a;color:#fff;padding:0 12px}
    .pay-methods{display:grid;gap:10px}
    .empty{border:1px dashed #333;border-radius:12px;padding:10px 12px;display:inline-block}
    @media (max-width:980px){ .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <header class="nav">
    <div class="shell bar">
      <a class="brand" href="index.html" style="display:flex;gap:10px;align-items:center">
        <span class="logo" style="width:36px;height:36px;border-radius:10px;background:#141414;display:grid;place-items:center;border:1px solid #333">JDM</span>
        <span>Aircry <span style="color:#ff1f1f">JDM</span></span>
      </a>
      <nav style="display:flex;gap:10px;align-items:center">
        <a class="btn" href="menu.html">üìú Carta</a>
        <a class="btn" href="carrito.html">üõçÔ∏è Carrito</a>
        <a class="btn" href="login.html">üë§</a>
      </nav>
    </div>
  </header>

  <main class="shell" style="padding-bottom:40px">
    <h1>Pago seguro</h1>

    <div class="grid">

      <section class="panel">
        <h3 style="margin-top:0">Tu pedido</h3>
        <div id="order-list" class="list"><div class="empty">Cargando‚Ä¶</div></div>

        <hr style="border:none;border-top:1px solid #222;margin:16px 0">

        <h3>Datos de entrega</h3>
        <form id="pay-form" onsubmit="return false;">
          <div class="field">
            <label for="name">Nombre y apellido</label>
            <input id="name" class="input" placeholder="Juan P√©rez" required />
          </div>
          <div class="field">
            <label for="email">Email</label>
            <input id="email" type="email" class="input" placeholder="ejemplo@email.com" required />
          </div>
          <div class="field">
            <label for="phone">Tel√©fono</label>
            <input id="phone" type="tel" class="input" placeholder="+56 9 1234 5678" required />
          </div>
          <div class="field">
            <label for="address">Direcci√≥n</label>
            <input id="address" class="input" placeholder="Calle 123, depto 45" required />
          </div>
          <div class="field">
            <label for="comuna">Comuna</label>
            <select id="comuna" class="input" required>
              <option value="">Selecciona‚Ä¶</option>
              <option value="Santiago">Santiago</option>
              <option value="Providencia">Providencia</option>
              <option value="Las Condes">Las Condes</option>
              <option value="√ëu√±oa">√ëu√±oa</option>
              <option value="La Florida">La Florida</option>
            </select>
          </div>

          <h3 style="margin-top:14px">M√©todo de pago</h3>
          <div class="pay-methods">
            <label><input type="radio" name="pay" value="webpay" checked> Webpay / Tarjeta</label>
            <label><input type="radio" name="pay" value="mercadopago"> MercadoPago</label>
            <label><input type="radio" name="pay" value="efectivo"> Efectivo (contra entrega)</label>
          </div>
        </form>
      </section>

      <aside class="panel">
        <h3 style="margin-top:0">Resumen</h3>
        <div class="summary">
          <div class="line"><span>Subtotal</span><span id="sum-sub">$0</span></div>
          <div class="line"><span>Delivery</span><span id="sum-del">$0</span></div>
          <div class="line total"><span>Total</span><span id="sum-tot">$0</span></div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px">
            <a class="btn ghost" href="carrito.html">‚Üê Volver al carrito</a>
            <button id="confirm" class="btn primary" type="button">Confirmar pago</button>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <script>

    (function(){
      const listEl = document.getElementById('order-list');
      const subEl  = document.getElementById('sum-sub');
      const delEl  = document.getElementById('sum-del');
      const totEl  = document.getElementById('sum-tot');
      const confirmBtn = document.getElementById('confirm');
      const comunaSel = document.getElementById('comuna');

      const DELIVERY_BY_COMUNA = {
        "Santiago": 2000,
        "Providencia": 2500,
        "Las Condes": 3000,
        "√ëu√±oa": 2200,
        "La Florida": 2600
      };

      const CLP = n => n.toLocaleString("es-CL",{style:"currency",currency:"CLP",maximumFractionDigits:0});

      let cart = [];
      try { cart = JSON.parse(localStorage.getItem('cart')) || []; } catch { cart = []; }

      function deliveryValue(){
        const c = comunaSel.value;
        return DELIVERY_BY_COMUNA[c] ?? 0;
      }

      function rowHTML(it){
        const imgMap = {
          "salmon": "img/roll_salmon.jpg",
          "nikkei": "img/roll_nikkei.jpg",
          "veggie": "img/veggie.jpg",
          "spicy": "img/spicy.jpg",
          "ebi": "img/ebi.jpg",
          "empanado": "img/roll_empanado.jpg",
          "spicy-emp": "img/roll_spicy_emp.jpg",
          "katsu": "img/roll_katsu.jpg",
          "crunch-emp": "img/roll_crunch.jpg",
          "empanado-ebi": "img/ebi.jpg",
          "handroll-salmon": "img/hr_salmon.jpg",
          "handroll-camaron": "img/hr_camaron.jpg",
          "handroll-spicy": "img/hr_spicy.jpg",
          "samurai": "img/samurai_tempura.jpg",
          "avotori": "img/avocado_tori.jpg",
          "spicysake": "img/sake_spicy.jpg"
        };
        const img = imgMap[it.id] || "img/roll_salmon.jpg";
        return `
          <div class="row">
            <img src="${img}" alt="${it.name}">
            <div>
              <div style="font-weight:800">${it.name}</div>
              <div style="color:#bbb">${CLP(it.price)} c/u √ó ${it.qty}</div>
            </div>
            <div class="price">${CLP(it.price * it.qty)}</div>
          </div>
        `;
      }

      function render(){
        if(!cart.length){
          listEl.innerHTML = `<div class="empty">Tu carrito est√° vac√≠o. <a class="btn" style="margin-left:8px" href="menu.html">Ir a la carta</a></div>`;
          subEl.textContent = CLP(0);
          delEl.textContent = CLP(0);
          totEl.textContent = CLP(0);
          confirmBtn.classList.add('disabled');
          confirmBtn.disabled = true;
          return;
        }
        listEl.innerHTML = cart.map(rowHTML).join("");
        const subtotal = cart.reduce((s,it)=> s + it.price*it.qty, 0);
        const delivery = deliveryValue();
        const total = subtotal + delivery;
        subEl.textContent = CLP(subtotal);
        delEl.textContent = CLP(delivery);
        totEl.textContent = CLP(total);
        confirmBtn.classList.remove('disabled');
        confirmBtn.disabled = false;
      }

      comunaSel.addEventListener('change', render);

      confirmBtn.addEventListener('click', ()=>{

        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim();
        const phone = document.getElementById('phone').value.trim();
        const address = document.getElementById('address').value.trim();
        const comuna = document.getElementById('comuna').value.trim();
        if(!name || !email || !phone || !address || !comuna){
          alert('Completa tus datos para continuar.');
          return;
        }
        if(!cart.length){
          alert('Tu carrito est√° vac√≠o.');
          return;
        }

        localStorage.removeItem('cart');
        window.location.href = 'gracias.html';
      });

      render();
    })();
  </script>
</body>
</html>
